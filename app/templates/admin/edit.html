{% extends "base.html" %}

{% block title %}{{ 'Edit' if article else 'New' }} Article - Admin{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
    <!-- Header -->
    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; margin-bottom: 2rem;" class="fade-in-up">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <a href="/admin/dashboard" style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: var(--bg-primary); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--text-muted); transition: all 150ms ease;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
            </a>
            <div>
                <h1 style="font-size: 1.5rem; margin-bottom: 0.125rem;">{{ 'Edit' if article else 'New' }} Article</h1>
                <p style="color: var(--text-muted); margin: 0; font-size: 0.9375rem;">
                    {% if article %}Editing: {{ article.title }}{% else %}Create a new article{% endif %}
                </p>
            </div>
        </div>
    </div>

    <!-- Form -->
    <form action="{{ '/admin/articles/' + article.slug + '/edit' if article else '/admin/articles/new' }}" method="POST" style="background: var(--bg-primary); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 2rem;" class="fade-in-up stagger-1">

        <!-- Title -->
        <div style="margin-bottom: 1.5rem;">
            <label for="title" style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">Title</label>
            <input
                type="text"
                name="title"
                id="title"
                value="{{ article.title if article else '' }}"
                required
                style="width: 100%; padding: 0.875rem 1rem; font-size: 1.125rem; font-weight: 500; color: var(--text-primary); background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 8px; outline: none; transition: all 150ms ease;"
                placeholder="Enter article title...">
        </div>

        <!-- Slug -->
        <div style="margin-bottom: 1.5rem;">
            <label for="slug" style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                Slug
                <span style="font-weight: 400; color: var(--text-muted);">(URL-friendly identifier)</span>
            </label>
            <div style="display: flex; align-items: center; background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 8px; overflow: hidden;">
                <span style="padding: 0.875rem 1rem; color: var(--text-muted); font-family: var(--font-mono); font-size: 0.9375rem; background: var(--bg-surface); border-right: 1px solid var(--border-default);">/article/</span>
                <input
                    type="text"
                    name="slug"
                    id="slug"
                    value="{{ article.slug if article else '' }}"
                    required
                    {{ 'readonly' if article else '' }}
                    style="flex: 1; padding: 0.875rem 1rem; font-size: 0.9375rem; font-family: var(--font-mono); color: var(--text-primary); background: transparent; border: none; outline: none; {% if article %}opacity: 0.6; cursor: not-allowed;{% endif %}"
                    placeholder="my-article-slug">
            </div>
            {% if article %}
            <p style="margin-top: 0.5rem; font-size: 0.8125rem; color: var(--text-muted);">Slug cannot be changed after creation.</p>
            {% endif %}
        </div>

        <!-- Description -->
        <div style="margin-bottom: 1.5rem;">
            <label for="description" style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                Description
                <span style="font-weight: 400; color: var(--text-muted);">(shown in article cards)</span>
            </label>
            <textarea
                id="description"
                name="description"
                rows="3"
                style="width: 100%; padding: 0.875rem 1rem; font-size: 1rem; color: var(--text-primary); background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 8px; outline: none; resize: vertical; transition: all 150ms ease; line-height: 1.6;"
                placeholder="A brief summary of your article...">{{ article.description if article else '' }}</textarea>
        </div>

        <!-- Content -->
        <div style="margin-bottom: 1.5rem;">
            <label for="content" style="display: flex; align-items: center; justify-content: space-between; font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                <span>Content <span style="font-weight: 400; color: var(--text-muted);">(Markdown)</span></span>
                <a href="https://www.markdownguide.org/cheat-sheet/" target="_blank" rel="noopener" style="font-size: 0.8125rem; font-weight: 400; color: var(--accent-primary);">Markdown Guide â†’</a>
            </label>
            <textarea
                id="content"
                name="content"
                rows="25"
                required
                style="width: 100%; padding: 1rem; font-size: 0.9375rem; font-family: var(--font-mono); color: var(--text-primary); background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 8px; outline: none; resize: vertical; transition: all 150ms ease; line-height: 1.7;"
                placeholder="Write your article content in Markdown...">{{ article.content if article else '' }}</textarea>
            <p style="margin-top: 0.5rem; font-size: 0.8125rem; color: var(--text-muted);">
                Supports: headings, bold, italic, links, code blocks, tables, lists, blockquotes, and more.
            </p>
        </div>

        <!-- Tags -->
        <div style="margin-bottom: 1.5rem;">
            <label for="tags" style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                Tags
                <span style="font-weight: 400; color: var(--text-muted);">(comma separated)</span>
            </label>
            <input
                type="text"
                name="tags"
                id="tags"
                value="{{ article.tags|join(', ') if article and article.tags else '' }}"
                style="width: 100%; padding: 0.875rem 1rem; font-size: 1rem; color: var(--text-primary); background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 8px; outline: none; transition: all 150ms ease;"
                placeholder="python, tutorial, web development">
        </div>

        <!-- Published Toggle -->
        <div style="margin-bottom: 2rem; padding: 1.25rem; background: var(--bg-surface); border-radius: 12px;">
            <label style="display: flex; align-items: flex-start; gap: 1rem; cursor: pointer;">
                <div style="position: relative; flex-shrink: 0; margin-top: 0.125rem;">
                    <input
                        id="is_published"
                        name="is_published"
                        type="checkbox"
                        value="true"
                        {{ 'checked' if article and article.is_published else '' }}
                        style="width: 44px; height: 24px; appearance: none; background: var(--bg-hover); border-radius: 9999px; cursor: pointer; transition: background 150ms ease;">
                    <span style="position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform 150ms ease; pointer-events: none;"></span>
                </div>
                <div>
                    <span style="display: block; font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">Published</span>
                    <span style="font-size: 0.875rem; color: var(--text-muted);">Make this article visible to the public. Unpublished articles are only visible in the admin dashboard.</span>
                </div>
            </label>
        </div>

        <!-- Actions -->
        <div style="display: flex; justify-content: flex-end; gap: 0.75rem; padding-top: 1.5rem; border-top: 1px solid var(--border-subtle);">
            <a href="/admin/dashboard" style="padding: 0.875rem 1.5rem; font-weight: 500; color: var(--text-secondary); background: var(--bg-elevated); border: 1px solid var(--border-default); border-radius: 8px; transition: all 150ms ease;">
                Cancel
            </a>
            <button
                type="submit"
                style="padding: 0.875rem 2rem; font-size: 1rem; font-weight: 600; color: var(--text-inverse); background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); border: none; border-radius: 8px; cursor: pointer; transition: all 150ms ease;">
                {% if article %}Save Changes{% else %}Create Article{% endif %}
            </button>
        </div>
    </form>
</div>

<style>
    input:focus, textarea:focus {
        border-color: var(--accent-primary) !important;
        box-shadow: 0 0 0 3px var(--accent-muted);
    }

    /* Toggle switch styling */
    input[type="checkbox"]:checked {
        background: var(--accent-primary) !important;
    }

    input[type="checkbox"]:checked + span {
        transform: translateX(20px);
    }

    button[type="submit"]:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg), var(--shadow-glow);
    }

    a[href="/admin/dashboard"]:hover {
        border-color: var(--accent-primary);
        color: var(--text-primary);
    }
</style>
{% endblock %}
